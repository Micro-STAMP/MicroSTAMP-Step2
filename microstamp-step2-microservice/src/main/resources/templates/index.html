<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1">
    <title>Home</title>

    <link th:href="@{assets/jquery-treetable/jquery.treetable.css}" th:rel="stylesheet"/>
    <link th:href="@{assets/jquery-treetable/jquery.treetable.theme.default.css}" th:rel="stylesheet"/>
    <link th:href="@{webjars/bootstrap/4.0.0-2/css/bootstrap.min.css} " th:rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
</head>
<body>
<div align="Left" class="container" style="margin-left: 2em; color:black;">
    <h1 style="margin-top: 0.5cm;">MicroSTAMP Step 2</h1>
    <br/>
    <div align="Left">
        <div class="container" style="margin-left: 2%;">
            <h2 style="display : inline-block;">Components</h2>
            <button class="btn btn-primary"
                    id="collapseAllComponentsButton" onclick=expandAllComponents()
                    style="display : inline-block; vertical-align : top; float : right;" type="button">Expand All
            </button>
            <div th:switch="${components.size}">
                <h5 th:case='1'>No components yet!</h5>
                <div th:case="*">
                    <div class="row" style="margin-top: -3%;">
                        <div class="col mt-5">
                            <table class="table" id="treeTable">
                                <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Border</th>
                                    <th>is visible?</th>
                                    <th>Type</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br/>
        <div class="container" style="margin-left: 2%;">
            <h2 style="display : inline-block;">Connections</h2>
            <button class="btn btn-primary"
                    id="collapseAllConnectionsButton" onclick=expandAllConnections()
                    style="display : inline-block; vertical-align : top; float : right;" type="button">Expand All
            </button>
            <div th:switch="${connections.size}">
                <h5 th:case='0'>No connections yet!</h5>
                <div th:case="*">
                    <div class="row" style="margin-top: -3%;">
                        <div class="col mt-5">
                            <table class="table" id="connectionTable">
                                <thead>
                                <tr>
                                    <th>Source</th>
                                    <th>Target</th>
                                    <th>Connection Type</th>
                                    <th>Style</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container" style="margin-left: 2%;">
            <h2 style="display : inline-block;">Variables</h2>
            <button class="btn btn-primary" id="collapseAllVariablesButton"
                    onclick=expandAllVariables() style="display : inline-block; vertical-align : top; float : right;" type="button">Expand All
            </button>
            <div th:switch="${variables.size}">
                <h5 th:case='0'>No variables yet!</h5>
                <div th:case="*">
                    <div class="row" style="margin-top: -3%;">
                        <div class="col mt-5">
                            <table class="table" id="variableTable">
                                <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Component</th>
                                    <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
                                    <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <input id="control_structure_id" th:value="${control_structure_id}" type="hidden"/>
        <br/>
    </div>
    <br/>
    <div>
        <div align="Left">

            <button class="btn btn-primary" data-target="#addComponentModal" data-toggle="modal" type="button">Add
                Component
            </button>

            <button class="btn btn-primary" data-target="#addConnectionModal" data-toggle="modal" type="button">Add
                Connection
            </button>

            <button class="btn btn-primary" data-target="#addVariableModal" data-toggle="modal" type="button">Add
                Variable
            </button>

            <a style="float: right;" th:href="@{/home}">
                <input class="btn btn-secondary" type="button" value="Return"/>
            </a>
        </div>

        <br/>

        <div align="Left">

            <label class="btn btn-primary">
                <button onclick=uploadImage() style="display:none;" type="button"></button>
                Upload Image
            </label>

            <label class="btn btn-secondary">
                <input accept="image/png, image/jpeg" id="image" name="image" style="display:none;" type="file"/>
                Choose File
            </label>

        </div>

        <div th:each="image : ${images}">
            <img th:src="@{/cs-images/{control_structure_id}/{imageName}(control_structure_id = ${control_structure_id}, imageName = ${image.name})}">
        </div>

    </div>
</div>

<div aria-hidden="true" class="modal fade" id="addComponentModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addComponentLabel">Add Component</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="component-name">Name:</label>
                        <input class="form-control" id="component-name" type="text">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="component-type">Type:</label>
                        <select class="form-control" id="component-type">
                            <option value="controller">Controller</option>
                            <option value="controlledProcess">Controlled Process</option>
                            <option value="actuator">Actuator</option>
                            <option value="sensor">Sensor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="component-border">Border:</label>
                        <select class="form-control" id="component-border">
                            <option th:each="p : ${style}" th:text="${p}" th:value="${p}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="component-father">Father:</label>
                        <select class="form-control" id="component-father">
                            <option value="null">NO FATHER</option>
                            <option th:each="p : ${componentsWithoutEnvironment}" th:text="${p.name}"
                                    th:value="${p.id}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">is visible? </label>
                        <input checked id="isVisible" name="visible" style="margin-left: 5%;" type="radio" value="true">
                        <label class="col-form-label" for="isVisible">True</label>
                        <input id="isNotVisible" name="visible" style="margin-left: 5%;" type="radio" value="false">
                        <label class="col-form-label" for="isNotVisible">False</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=addComponent() type="button">Add Component</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="addConnectionModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addConnectionLabel">Add Connection</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="connection-source">Source:</label>
                        <select class="form-control" id="connection-source">
                            <option th:each="s : ${components}" th:text="${s.name}" th:value="${s.id}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="connection-target">Target:</label>
                        <select class="form-control" id="connection-target">
                            <option th:each="t : ${components}" th:text="${t.name}" th:value="${t.id}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="connection-type">Connection Type:</label>
                        <select class="form-control" id="connection-type">
                            <option th:each="p : ${connectionType}" th:text="${p}" th:value="${p}"/>
                        </select>
                        <select class="form-control" id="connection-type-pi">
                            <option th:each="pi : ${process_input}" th:text="${pi}" th:value="${pi}"/>
                        </select>
                        <select class="form-control" disabled id="connection-type-po">
                            <option selected th:text="${process_output}" th:value="${process_output}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="connection-style">Style:</label>
                        <select class="form-control" id="connection-style">
                            <option th:each="p : ${style}" th:text="${p}" th:value="${p}"/>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=addConnection() type="button">Add Connection</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="editComponentModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editComponentLabel">Edit Component</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="component-edit-name">Name:</label>
                        <input class="form-control" id="component-edit-name" type="text">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="component-edit-type">Type:</label>
                        <select class="form-control" id="component-edit-type">
                            <option value="controller">Controller</option>
                            <option value="controlledProcess">Controlled Process</option>
                            <option value="actuator">Actuator</option>
                            <option value="sensor">Sensor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="component-edit-border">Border:</label>
                        <select class="form-control" id="component-edit-border">
                            <option th:each="p : ${style}" th:text="${p}" th:value="${p}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="component-edit-father">Father:</label>
                        <select class="form-control" id="component-edit-father">
                            <option value="null">NO FATHER</option>
                            <option th:each="p : ${componentsWithoutEnvironment}" th:text="${p.name}"
                                    th:value="${p.id}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">is visible? </label>
                        <input checked id="editIsVisible" name="visible" style="margin-left: 5%;" type="radio"
                               value="true">
                        <label class="col-form-label" for="isVisible">True</label>
                        <input id="editIsNotVisible" name="visible" style="margin-left: 5%;" type="radio" value="false">
                        <label class="col-form-label" for="isNotVisible">False</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=sendEditedComponent() type="button">Edit Component</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="editConnectionModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editConnectionLabel">Edit Connection</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" onclick=unwrapLast() type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="connection-edit-source">Source:</label>
                        <select class="form-control" id="connection-edit-source">
                            <option th:each="s : ${components}" th:text="${s.name}" th:value="${s.id}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="connection-edit-target">Target:</label>
                        <select class="form-control" id="connection-edit-target">
                            <option th:each="t : ${components}" th:text="${t.name}" th:value="${t.id}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="connection-edit-type">Connection Type:</label>
                        <select class="form-control" id="connection-edit-type">
                            <option th:each="p : ${connectionType}" th:text="${p}" th:value="${p}"/>
                        </select>
                        <select class="form-control" id="connection-edit-type-pi">
                            <option th:each="pi : ${process_input}" th:text="${pi}" th:value="${pi}"/>
                        </select>
                        <select class="form-control" disabled id="connection-edit-type-po">
                            <option selected th:text="${process_output}" th:value="${process_output}"/>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="connection-edit-style">Style:</label>
                        <select class="form-control" id="connection-edit-style">
                            <option th:each="p : ${style}" th:text="${p}" th:value="${p}"/>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" onclick=unwrapLast() type="button">Close</button>
                <button class="btn btn-primary" onclick=sendEditedConnection() type="button">Edit Connection</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="confirmComponentDeleteModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Component</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete
                <span id="componentToBeDeletedName"></span>
                ?
                <br/>
                <span id="itemsToBeDeletedSpan">The following items will be deleted as well:</span>
                <ul id="itemsToBeDeleted">
                    <li id="componentsToBeDeletedLi">Components</li>
                    <ul id="componentsToBeDeleted">
                    </ul>
                    <li id="connectionsToBeDeletedLi">Connections</li>
                    <ul id="connectionsToBeDeleted">
                    </ul>
                </ul>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=deleteComponent() type="button">Delete Component</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="confirmConnectionDeleteModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Connection</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the following connection ?
                <br/><br/>
                <span id="connectionToBeDeletedType"></span>
                <br/>
                <span id="connectionToBeDeletedSourceName"></span>
                --->
                <span id="connectionToBeDeletedTargetName"></span>
                <br/>
                <ul id="labelsToBeDeleted"/>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=deleteConnection() type="button">Delete Connection</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="addLabelModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Label</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="label-name">Label:</label>
                        <input class="form-control" id="label-name" type="text">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=addLabel() type="button">Add Label</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="editLabelModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Label</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="label-edit-name">Label:</label>
                        <input class="form-control" id="label-edit-name" type="text">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=editLabel() type="button">Edit Label</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="confirmLabelDeleteModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Label</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the following Label ?
                <br/><br/>
                <span id="label_delete_name"></span>
                <br/>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=deleteLabel() type="button">Delete Label</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="addVariableModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Variable</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="variable-name">Name:</label>
                        <input class="form-control" id="variable-name" type="text">
                    </div>
                    <div>
                        <label class="col-form-label" for="variable-component">Component:</label>
                        <select class="form-control" id="variable-component">
                            <option th:each="p : ${controllersControlledProcess}" th:text="${p.name}"
                                    th:value="${p.id}"/>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=addVariable() type="button">Add Variable</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="editVariableModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Variable</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="label-edit-name">Name:</label>
                        <input class="form-control" id="variable-edit-name" type="text">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=sendEditedVariable() type="button">Edit Variable</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="confirmVariableDeleteModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Variable</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the following Variable ?
                <br/><br/>
                <span id="variable_delete_name"></span>
                <br/>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=deleteVariable() type="button">Delete Variable</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="addStateModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add State</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="label-name">Name:</label>
                        <input class="form-control" id="state-name" type="text">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=addState() type="button">Add State</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="editStateModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit State</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="state-edit-name">Name:</label>
                        <input class="form-control" id="state-edit-name" type="text">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=sendEditedState() type="button">Edit State</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="confirmStateDeleteModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete State</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the following State ?
                <br/><br/>
                <span id="state_delete_name"></span>
                <br/>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=deleteState() type="button">Delete State</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="environmentRestrictionModal" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Exception</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" onclick=returnEnvironmentRestriction()
                        type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Exception: can't create a Component named "Environment" !
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" onclick=returnEnvironmentRestriction()
                        type="button">Close
                </button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="namelessRestrictionModal" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Exception</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" onclick=returnNamelessRestriction()
                        type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Exception: can't create a Component without a name !
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" onclick=returnNamelessRestriction()
                        type="button">Close
                </button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="orphanRestrictionModal" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Exception</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" onclick=returnOrphanRestriction()
                        type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Exception: a Component can't be child of his child !
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" onclick=returnOrphanRestriction() type="button">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="addResponsibilityModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Responsibility</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="responsibility-name">Responsibility:</label>
                        <input class="form-control" id="responsibility-name" type="text">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="responsibility-ssc">System Safety Constraint
                            Associated:</label>
                        <input class="form-control" id="responsibility-ssc" type="text">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=addResponsibility() type="button">Add Responsibility</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="editResponsibilityModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Responsibility</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="col-form-label" for="responsibility-edit-name">Responsibility:</label>
                        <input class="form-control" id="responsibility-edit-name" type="text">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label" for="responsibility-edit-ssc">System Safety Constraint
                            Associated:</label>
                        <input class="form-control" id="responsibility-edit-ssc" type="text">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=sendEditedResponsibility() type="button">Edit Responsibility
                </button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" class="modal fade" id="confirmResponsibilityDeleteModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Responsibility</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the following Responsibility ?
                <br/><br/>
                <span id="responsibility_delete_name"></span>
                <br/>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                <button class="btn btn-primary" onclick=deleteResponsibility() type="button">Delete Responsibility
                </button>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script th:src="@{/webjars/popper.js/umd/popper.min.js}"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>

<script type="text/javascript">

    var componentSelected;
    var componentSelectedOriginalType;
    var componentToBeDeleted;
    var connectionSelected;
    var connectionToBeDeleted;
    var connectionToBeLabeled;
    var labelToBeEdited;
    var labelToBeDeleted;
    var variableToBeEdited;
    var variableToBeDeleted;
    var variableToBeStated;
    var stateToBeEdited;
    var stateToBeDeleted;
    var componentToResponsibility;
    var responsibilityToBeEdited;
    var responsibilityToBeDeleted;
    var wrapped = false;
    var orphan = false; // orphanRestriction
    var actual_modal; // 0 -> addComponent 1 -> editComponent //control the restrictions return

    $(window).ready(function () {
        var cs_id = $("#control_structure_id").val();
        $.ajax({
            "type": 'get',
            "url": '/components/controlstructure/' + cs_id,
            "dataType": "json",
            "success": function (data) {
                var backup = data;
                $.each(data, function (idx, obj) {
                    if(obj.father == null && obj.name != "Environment"){
                        if(obj.type == "Controller" || obj.type == "ControlledProcess"){
                            $("#treeTable").append("<tr data-tt-id=\"" + obj.id + "\" data-tt-parent-id=\"" + obj.father + "\"><td>" + obj.name + "</td><td>" + obj.border + "</td><td>" + obj.isVisible + "</td><td>" + obj.type + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editComponentModal' onclick = editComponent(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmComponentDeleteModal' onclick = loadComponentsAndConnectionsToBeDeleted(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-trash'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#addResponsibilityModal' onclick = loadComponentToResponsibility(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-plus'></span></button></td></tr>");
                            if(obj.responsibilities.length > 0){
                                $("#treeTable").append("<tr data-tt-id=\"" + obj.id +"-r" + "\" data-tt-parent-id=\"" + obj.id + "\"><td>" + "Responsibilities" + "</td><td>" + " " + "</td><td>" + " " + "</td><td>" + "System Safety Constraint Associated" + "</td><td>" + " " + "</td></tr>");
                                $.each(obj.responsibilities, function (idx, responsibility) {
                                    $("#treeTable").append("<tr data-tt-id=\"" + obj.id + "-r-" + responsibility.id + "\" data-tt-parent-id=\"" + obj.id + "-r" + "\"><td>" + responsibility.responsibility + "</td><td>" + " " + "</td><td>" + " " + "</td><td>" + responsibility.systemSafetyConstraintAssociated + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editResponsibilityModal' onclick = loadResponsibilityToBeEdited(this.id) type='button' id=\"" + responsibility.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmResponsibilityDeleteModal' onclick = loadResponsibilityToBeDeleted(this.id) type='button' id=\"" + responsibility.id + "\"><span class='fa fa-trash'></span></button></td></tr>");
                                });
                            }
                            addChildren(obj.id,backup);
                        }else{
                            $("#treeTable").append("<tr data-tt-id=\"" + obj.id + "\" data-tt-parent-id=\"" + obj.father + "\"><td>" + obj.name + "</td><td>" + obj.border + "</td><td>" + obj.isVisible + "</td><td>" + obj.type + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editComponentModal' onclick = editComponent(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmComponentDeleteModal' onclick = loadComponentsAndConnectionsToBeDeleted(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-trash'></span></button></td></tr>");
                            addChildren(obj.id,backup);
                        }
                    }
                });
                $("#treeTable").treetable({
                    expandable: true,
                    initialState: "collapsed",
                    clickableNodeNames: true,
                    indent: 30
                });
            }
        });
        $.ajax({
            "type": 'get',
            "url": '/connections/controlstructure/' + cs_id,
            "dataType": "json",
            "success": function (data) {
                $.each(data, function (idx, obj) {
                    $("#connectionTable").append("<tr data-tt-id=\"" + obj.id + "\" data-tt-parent-id=\"" + obj.father + "\"><td>" + obj.sourceName + "</td><td>" + obj.targetName + "</td><td>" + obj.connectionType + "</td><td>" + obj.style + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editConnectionModal' onclick = editConnection(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmConnectionDeleteModal' onclick = loadConnectionToBeDeleted(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-trash'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#addLabelModal' onclick = loadConnectionToBeLabeled(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-plus'></span></button></td></tr>");
                    $.each(obj.labels, function (idx, label) {
                        $("#connectionTable").append("<tr data-tt-id=\"" + obj.id + "-l-" + label.id + "\" data-tt-parent-id=\"" + obj.id + "\"><td>" + label.label + "</td><td>" + " " + "</td><td>" + " " + "</td><td>" + "LABEL" + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editLabelModal' onclick = loadLabelToBeEdited(this.id) type='button' id=\"" + label.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmLabelDeleteModal' onclick = loadLabelToBeDeleted(this.id) type='button' id=\"" + label.id + "\"><span class='fa fa-trash'></span></button></td></tr>");
                    });
                });
                $("#connectionTable").treetable({
                    expandable: true,
                    initialState: "collapsed",
                    clickableNodeNames: true,
                    indent: 30
                });
            }
        });
        $.ajax({
            "type": 'get',
            "url": '/components/controlstructure/' + cs_id,
            "dataType": "json",
            "success": function (data) {
                $.each(data, function (idx, obj) {
                    if(obj.type == "Controller" || obj.type == "ControlledProcess"){
                        $.each(obj.variables, function (idx, variable) {
                            var id = variable.id;
                            $("#variableTable").append("<tr data-tt-id=\"" + variable.id + "\" data-tt-parent-id=\"" + " " + "\"><td>" + variable.name + "</td><td>" + obj.name + "</td><td>" + " " + "</td><td>" + " " + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editVariableModal' onclick = editVariable(id) type='button' id=\"" + variable.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmVariableDeleteModal' onclick = loadVariableToBeDeleted(id) type='button' id=\"" + variable.id + "\"><span class='fa fa-trash'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#addStateModal' onclick = loadVariableToBeStated(id) type='button' id=\"" + variable.id + "\"><span class='fa fa-plus'></span></button></td></tr>");
                            $.each(variable.states, function (idx, state) {
                                $("#variableTable").append("<tr data-tt-id=\"" + variable.id + "-s-" + state.id + "\" data-tt-parent-id=\"" + variable.id + "\"><td>" + state.name + "</td><td>" + " " + "</td><td>" + " " + "</td><td>" + " " + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editStateModal' onclick = loadStateToBeEdited(this.id) type='button' id=\"" + state.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmStateDeleteModal' onclick = loadStateToBeDeleted(this.id) type='button' id=\"" + state.id + "\"><span class='fa fa-trash'></span></button></td></tr>");
                            });
                        });
                    }
                });
                $("#variableTable").treetable({
                    expandable: true,
                    initialState: "collapsed",
                    clickableNodeNames: true,
                    indent: 30
                });
            }
        });
    });

    var previous;
    var previous_edit;

    $(window).on('load', function() {
        previous = $("#connection-source").val();
        $("#connection-target option[value="+previous+"]").wrap('<span/>');
        if($("#connection-source option[value="+previous+"]").text() == "Environment"){
            $("#connection-type-pi").css("display","");
            $("#connection-type-po").css("display","none");
            $("#connection-type").css("display","none");
        }
    });

    $("#connection-source").on('change',function(){
        conn_target_value = $("#connection-target").val();
        if($("#connection-source option[value="+this.value+"]").text() == "Environment"){
            $("#connection-type-pi").css("display","");
            $("#connection-type-po").css("display","none");
            $("#connection-type").css("display","none");
        }else if($("#connection-target option[value="+conn_target_value+"]").text() == "Environment"){
            $("#connection-type-po").css("display","");
            $("#connection-type-pi").css("display","none");
            $("#connection-type").css("display","none");
        }else{
            $("#connection-type-po").css("display","none");
            $("#connection-type-pi").css("display","none");
            $("#connection-type").css("display","");
            $("#connection-type").val("CONTROL_ACTION");
        }
    });

    $("#connection-edit-source").on('change',function(){
        conn_target_value = $("#connection-edit-target").val();
        if($("#connection-edit-source option[value="+this.value+"]").text() == "Environment"){
            $("#connection-edit-type-pi").css("display","");
            $("#connection-edit-type-po").css("display","none");
            $("#connection-edit-type").css("display","none");
        }else if($("#connection-edit-target option[value="+conn_target_value+"]").text() == "Environment"){
            $("#connection-edit-type-po").css("display","");
            $("#connection-edit-type-pi").css("display","none");
            $("#connection-edit-type").css("display","none");
        }else{
            $("#connection-edit-type-po").css("display","none");
            $("#connection-edit-type-pi").css("display","none");
            $("#connection-edit-type").css("display","");
            $("#connection-edit-type").val("CONTROL_ACTION");
        }
    });


    $("#connection-target").on('change',function(){
        conn_source_value = $("#connection-source").val();
        if($("#connection-target option[value="+this.value+"]").text() == "Environment"){
            $("#connection-type-pi").css("display","none");
            $("#connection-type-po").css("display","");
            $("#connection-type").css("display","none");
        }else if($("#connection-source option[value="+conn_source_value+"]").text() == "Environment"){
            $("#connection-type-po").css("display","none");
            $("#connection-type-pi").css("display","");
            $("#connection-type").css("display","none");
        }else{
            $("#connection-type-po").css("display","none");
            $("#connection-type-pi").css("display","none");
            $("#connection-type").css("display","");
            $("#connection-type").val("CONTROL_ACTION");
        }
    });

    $("#connection-edit-target").on('change',function(){
        conn_source_value = $("#connection-edit-source").val();
        if($("#connection-edit-target option[value="+this.value+"]").text() == "Environment"){
            $("#connection-edit-type-pi").css("display","none");
            $("#connection-edit-type-po").css("display","");
            $("#connection-edit-type").css("display","none");
        }else if($("#connection-edit-source option[value="+conn_source_value+"]").text() == "Environment"){
            $("#connection-edit-type-po").css("display","none");
            $("#connection-edit-type-pi").css("display","");
            $("#connection-edit-type").css("display","none");
        }else{
            $("#connection-edit-type-po").css("display","none");
            $("#connection-edit-type-pi").css("display","none");
            $("#connection-edit-type").css("display","");
            $("#connection-edit-type").val("CONTROL_ACTION");
        }
    });


    $("#connection-source").on('focus', function () {
        previous = this.value;
    }).change(function() {
        var selected = this.value;
        $("#connection-target option[value="+selected+"]").wrap('<span/>');
        $("#connection-target option[value="+previous+"]").unwrap();
        previous = this.value;

        conn_target_value = $("#connection-target").val();
        if($("#connection-source option[value="+this.value+"]").text() == "Environment"){
            $("#connection-type-pi").css("display","");
            $("#connection-type-po").css("display","none");
            $("#connection-type").css("display","none");
        }else if($("#connection-target option[value="+conn_target_value+"]").text() == "Environment"){
            $("#connection-type-po").css("display","");
            $("#connection-type-pi").css("display","none");
            $("#connection-type").css("display","none");
        }else{
            $("#connection-type-po").css("display","none");
            $("#connection-type-pi").css("display","none");
            $("#connection-type").css("display","");
            $("#connection-type").val("CONTROL_ACTION");
        }
    });

    $("#connection-edit-source").on('focus', function () {
        previous_edit = this.value;
    }).change(function() {
        var selected = this.value;
        $("#connection-edit-target option[value="+selected+"]").wrap('<span/>');
        $("#connection-edit-target option[value="+previous_edit+"]").unwrap();
        previous_edit = this.value;

        conn_target_value = $("#connection-edit-target").val();
        if($("#connection-edit-source option[value="+this.value+"]").text() == "Environment"){
            $("#connection-edit-type-pi").css("display","");
            $("#connection-edit-type-po").css("display","none");
            $("#connection-edit-type").css("display","none");
        }else if($("#connection-edit-target option[value="+conn_target_value+"]").text() == "Environment"){
            $("#connection-edit-type-po").css("display","");
            $("#connection-edit-type-pi").css("display","none");
            $("#connection-edit-type").css("display","none");
        }else{
            $("#connection-edit-type-po").css("display","none");
            $("#connection-edit-type-pi").css("display","none");
            $("#connection-edit-type").css("display","");
            $("#connection-edit-type").val("CONTROL_ACTION");
        }
    });

    $("#component-edit-father").on('focus', function () {
        $("#component-edit-father option[value="+componentSelected+"]").wrap('<span/>');
    });

    $("#component-edit-father").on('focusout', function () {
        $("#component-edit-father option[value="+componentSelected+"]").unwrap();
    });

    function addChildren(id, backup){
       $.each(backup, function (idx, obj) {
            if(obj.father != null){
                if(obj.father.id == id){
                    if(obj.type == "Controller" || obj.type == "ControlledProcess"){
                        $("#treeTable").append("<tr data-tt-id=\"" + obj.id + "\" data-tt-parent-id=\"" + obj.father.id + "\"><td>" + obj.name + "</td><td>" + obj.border + "</td><td>" + obj.isVisible + "</td><td>" + obj.type + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editComponentModal' onclick = editComponent(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmComponentDeleteModal' onclick = loadComponentsAndConnectionsToBeDeleted(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-trash'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#addResponsibilityModal' onclick = loadComponentToResponsibility(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-plus'></span></button></td></tr>");
                        if(obj.responsibilities.length > 0){
                                $("#treeTable").append("<tr data-tt-id=\"" + obj.id +"-r" + "\" data-tt-parent-id=\"" + obj.id + "\"><td>" + "Responsibilities" + "</td><td>" + " " + "</td><td>" + " " + "</td><td>" + "System Safety Constraint Associated" + "</td><td>" + " " + "</td></tr>");
                                $.each(obj.responsibilities, function (idx, responsibility) {
                                    $("#treeTable").append("<tr data-tt-id=\"" + obj.id + "-r-" + responsibility.id + "\" data-tt-parent-id=\"" + obj.id + "-r" + "\"><td>" + responsibility.responsibility + "</td><td>" + " " + "</td><td>" + " " + "</td><td>" + responsibility.systemSafetyConstraintAssociated + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editResponsibilityModal' onclick = loadResponsibilityToBeEdited(this.id) type='button' id=\"" + responsibility.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmResponsibilityDeleteModal' onclick = loadResponsibilityToBeDeleted(this.id) type='button' id=\"" + responsibility.id + "\"><span class='fa fa-trash'></span></button></td></tr>");
                                });
                            }
                        addChildren(obj.id,backup);
                    }else{
                        $("#treeTable").append("<tr data-tt-id=\"" + obj.id + "\" data-tt-parent-id=\"" + obj.father.id + "\"><td>" + obj.name + "</td><td>" + obj.border + "</td><td>" + obj.isVisible + "</td><td>" + obj.type + "</td><td><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#editComponentModal' onclick = editComponent(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-pencil' aria-hidden='true'></span></button><button style='cursor: pointer; border-radius: 5px;' data-toggle='modal' data-target='#confirmComponentDeleteModal' onclick = loadComponentsAndConnectionsToBeDeleted(this.id) type='button' id=\"" + obj.id + "\"><span class='fa fa-trash'></span></button></td></tr>");
                        addChildren(obj.id,backup);
                    }
                }
            }
       });
    }

    function addComponent(){
        if(document.getElementById('isVisible').checked) {
            var checkedValue = new Boolean(1);
        }else{
            var checkedValue = new Boolean(0);
        }

        var component = {
            name: $("#component-name").val(),
            father_id: $("#component-father").val(),
            border: $("#component-border").val(),
            isVisible: checkedValue,
            control_structure_id: $("#control_structure_id").val(),
        }

        if($("#component-type").val() == "controlledProcess")
            var componentType = $("#component-type").val() + "es";
        else var componentType = $("#component-type").val() + "s";

        if($("#component-name").val() == "Environment"){
            $("#addComponentModal").modal("hide");
            actual_modal = 0;
            $("#environmentRestrictionModal").modal("show");
        }else if($("#component-name").val() == ""){
            $("#addComponentModal").modal("hide");
            actual_modal = 0;
            $("#namelessRestrictionModal").modal("show");
        }else{
            $.ajax({
                url: '/'+ componentType,
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data) {
                    location.reload();
                },
                data: JSON.stringify(component)
            });
        }
    }

    function returnEnvironmentRestriction(){
        $("#environmentRestrictionModal").modal("hide");
        if(actual_modal == 0)
            $("#addComponentModal").modal("show");
        else
            $("#editComponentModal").modal("show");
    }

    function returnNamelessRestriction(){
        $("#namelessRestrictionModal").modal("hide");
        if(actual_modal == 0)
            $("#addComponentModal").modal("show");
        else
            $("#editComponentModal").modal("show");
    }

    function returnOrphanRestriction(){
        $("#orphanRestrictionModal").modal("hide");
        if(actual_modal == 0)
            $("#addComponentModal").modal("show");
        else
            $("#editComponentModal").modal("show");
    }

    function addConnection() {
        var connType;

        if($("#connection-type-pi").css("display") == "none" && $("#connection-type-po").css("display") == "none"){
            connType = $("#connection-type").val();
        }else if($("#connection-type-pi").css("display") == "none" && $("#connection-type").css("display") == "none"){
            connType = $("#connection-type-po").val();
        }else{
            connType = $("#connection-type-pi").val();
        }

        var connection = {
            source_id: $("#connection-source").val(),
            target_id: $("#connection-target").val(),
            connectionType: connType,
            style: $("#connection-style").val(),
            control_structure_id: $("#control_structure_id").val(),
        }

        $('#target').html('sending..');

        $.ajax({
            url: '/connections',
            type: 'post',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(connection)
        });
    }

    function editComponent(id){
        componentSelected = id;
        $.ajax({
            url: '/components/'+ id,
            type: 'get',
            success: function (data) {
                $("#component-edit-name").val(data.name);
                switch(data.type){
                    case "Controller":
                        $("#component-edit-type").val("controller");
                        break;
                    case "Actuator":
                        $("#component-edit-type").val("actuator");
                        break;
                    case "Sensor":
                        $("#component-edit-type").val("sensor");
                        break;
                    case "ControlledProcess":
                        $("#component-edit-type").val("controlledProcess");
                        break;
                }
                $("#component-edit-border").val(data.border);
                if(data.father == null)
                    $("#component-edit-father").val("null");
                else
                    $("#component-edit-father").val(data.father.id);
                if(data.isVisible == true)
                    $("#editIsVisible").prop("checked", true);
                else
                    $("#editIsNotVisible").prop("checked", true);

                componentSelectedOriginalType = $("#component-edit-type").val();
            },
        });
    }

    function sendEditedComponent(){
        if(document.getElementById('editIsVisible').checked) {
            var checkedValue = new Boolean(1);
        }else{
            var checkedValue = new Boolean(0);
        }

        var type = $("#component-edit-type").val();
        type = type.charAt(0).toUpperCase() + type.slice(1);

        var component = {
            name: $("#component-edit-name").val(),
            father_id: $("#component-edit-father").val(),
            border: $("#component-edit-border").val(),
            isVisible: checkedValue,
            control_structure_id: $("#control_structure_id").val(),
            type: type,
        }

        if(componentSelectedOriginalType == "controlledProcess")
            var componentType = componentSelectedOriginalType + "es";
        else var componentType = componentSelectedOriginalType + "s";

        var father_id = $("#component-edit-father").val();

        $.when(checkOrphanRestriction(componentSelected, father_id)).done(function(a1){
            if($("#component-edit-name").val() == "Environment"){
                $("#editComponentModal").modal("hide");
                actual_modal = 1;
                $("#environmentRestrictionModal").modal("show");
            }else if($("#component-edit-name").val() == ""){
                $("#editComponentModal").modal("hide");
                actual_modal = 1;
                $("#namelessRestrictionModal").modal("show");
            }else if(orphan){
                $("#editComponentModal").modal("hide");
                actual_modal = 1;
                $("#orphanRestrictionModal").modal("show");
                orphan = false;
            }else{
                console.log(component);
                $.ajax({
                    url: '/'+ componentType + '/' + componentSelected,
                    type: 'put',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data) {
                        location.reload();
                    },
                    data: JSON.stringify(component)
                });
            }
        });
    }

    function checkOrphanRestriction(componentId, fatherId){
         return $.ajax({
                    url: '/components/listComponentsChildren/'+ componentId,
                    type: 'get',
                    success: function (data) {
                         $.each(data, function (idx, obj) {
                            if(obj.id == fatherId){
                                orphan = true;
                            }
                        });
                    },
                });
    }

    function editConnection(id){
        connectionSelected = id;

         $.ajax({
            url: '/connections/'+ id,
            type: 'get',
            success: function (data) {

                if(data.connectionType == "PROCESS_INPUT" || data.connectionType == "DISTURBANCE"){
                    $("#connection-edit-type-pi").val(data.connectionType);
                }else if(data.connectionType == "PROCESS_OUTPUT"){
                    $("#connection-edit-type-po").val(data.connectionType);
                }else{
                    $("#connection-edit-type").val(data.connectionType);
                }

                $("#connection-edit-style").val(data.style);
                $("#connection-edit-source").val(data.source.id);
                $("#connection-edit-target").val(data.target.id);
                previous_edit = data.source.id;
                wrapFirst(previous_edit);

                var conn_target_value = data.target.id;
                var conn_source_value = data.source.id;

                if($("#connection-edit-source option[value="+conn_source_value+"]").text() == "Environment"){
                    $("#connection-edit-type-pi").css("display","");
                    $("#connection-edit-type-po").css("display","none");
                    $("#connection-edit-type").css("display","none");
                }else if($("#connection-edit-target option[value="+conn_target_value+"]").text() == "Environment"){
                    $("#connection-edit-type-po").css("display","");
                    $("#connection-edit-type-pi").css("display","none");
                    $("#connection-edit-type").css("display","none");
                }else{
                    $("#connection-edit-type-po").css("display","none");
                    $("#connection-edit-type-pi").css("display","none");
                    $("#connection-edit-type").css("display","");
                }
            },
        });
    }

    function wrapFirst(val){
        $("#connection-edit-target option[value="+val+"]").wrap('<span/>');
    }

    function unwrapLast(){
         $("#connection-edit-target option[value="+previous_edit+"]").unwrap();
    }

    function sendEditedConnection(){

        var connType;
        if($("#connection-edit-type-pi").css("display") == "none" && $("#connection-edit-type-po").css("display") == "none"){
            connType = $("#connection-edit-type").val();
        }else if($("#connection-edit-type-pi").css("display") == "none" && $("#connection-edit-type").css("display") == "none"){
            connType = $("#connection-edit-type-po").val();
        }else{
            connType = $("#connection-edit-type-pi").val();
        }

        var connection = {
            source_id: $("#connection-edit-source").val(),
            target_id: $("#connection-edit-target").val(),
            connectionType: connType,
            style: $("#connection-edit-style").val(),
            control_structure_id: $("#control_structure_id").val(),
        }

        $.ajax({
            url: '/connections/' + connectionSelected,
            type: 'put',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(connection)
        });
    }

    function loadComponentsAndConnectionsToBeDeleted(id){
        componentToBeDeleted = id;
        $("#itemsToBeDeleted").css("display","grid");
        $("#itemsToBeDeletedSpan").css("display","flex");
        $("#componentsToBeDeleted").css("display","grid");
        $("#connectionsToBeDeleted").css("display","grid");
        $("#componentsToBeDeletedLi").css("display","");
        $("#connectionsToBeDeletedLi").css("display","");

        $.ajax({
            url: '/components/'+ id,
            type: 'get',
            success: function (data) {
                 $("#componentToBeDeletedName").text(data.name);
            },
        });

        $("#componentsToBeDeleted").empty();
        $("#connectionsToBeDeleted").empty();

        $.ajax({
            url: '/components/listComponentsAndConnectionsToBeDeleted/'+ id,
            type: 'get',
            success: function (data) {
                var numComp = 0;
                var numConn = 0;
                $.each(data, function (idx, obj) {
                    if(obj.name != null){
                        $("#componentsToBeDeleted").append("<li>" + obj.name + "</li>");
                        numComp++;
                    }else{
                        $("#connectionsToBeDeleted").append("<li>" + obj.source.name + " ---> " + obj.target.name + "</li>");
                        numConn++;
                    }
                });
                if((numComp == 0) && (numConn == 0)){
                    $("#itemsToBeDeleted").css("display","none");
                    $("#itemsToBeDeletedSpan").css("display","none");
                }else if(numComp == 0){
                    $("#componentsToBeDeleted").css("display","none");
                    $("#componentsToBeDeletedLi").css("display","none");
                }else if(numConn == 0){
                    $("#connectionsToBeDeleted").css("display","none");
                    $("#connectionsToBeDeletedLi").css("display","none");
                }
            },
        });
    }

    function deleteComponent(){
        $.ajax({
            url: '/components/'+ componentToBeDeleted,
            type: 'delete',
            success: function (data) {
                location.reload();
            },
        });
    }

    function loadConnectionToBeDeleted(id){
        connectionToBeDeleted = id;
        $.ajax({
            url: '/connections/'+ id,
            type: 'get',
            success: function (data) {
                 $("#connectionToBeDeletedType").text(data.connectionType);
                 $("#connectionToBeDeletedSourceName").text(data.source.name);
                 $("#connectionToBeDeletedTargetName").text(data.target.name);
            },
        });
        $("#labelsToBeDeleted").empty();
        $.ajax({
            url: '/labels/connection/'+ id,
            type: 'get',
            success: function (data) {
                 $.each(data, function (idx, obj) {
                    $("#labelsToBeDeleted").append("<li>" + obj.label + "</li>");
                });
            },
        });
    }

    function deleteConnection(){
        $.ajax({
            url: '/connections/'+ connectionToBeDeleted,
            type: 'delete',
            success: function (data) {
                location.reload();
            },
        });
    }

    function uploadImage(){

        image = $("#image").val();
        var control_structure_id = $("#control_structure_id").val();
        var myFile = $('#image').prop('files');

        var data = new FormData();
        data.append('image',myFile[0]);

        $.ajax({
            url: '/images/' + control_structure_id,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                location.reload();
            },
            data:data
        });
    }

    function loadConnectionToBeLabeled(id){
        connectionToBeLabeled = id;
    }

    function addLabel(){
        var label = {
            label: $("#label-name").val(),
            connection_id: connectionToBeLabeled,
        }

        $.ajax({
            url: '/labels',
            type: 'post',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(label)
        });
    }

    function loadLabelToBeEdited(id){
        labelToBeEdited = id;
        $.ajax({
            url: '/labels/'+ id,
            type: 'get',
            success: function (data) {
                $("#label-edit-name").val(data.label);
            },
        });
    }

    function editLabel() {
        var label = {
            label: $("#label-edit-name").val(),
        }

        $.ajax({
            url: '/labels/' + labelToBeEdited,
            type: 'put',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(label)
        });
    }

    function loadLabelToBeDeleted(id){
        labelToBeDeleted = id;
        $.ajax({
                url: '/labels/'+ id,
                type: 'get',
                success: function (data) {
                     $("#label_delete_name").text(data.label);
                },
            });
    }

    function deleteLabel(){
        $.ajax({
            url: '/labels/'+ labelToBeDeleted,
            type: 'delete',
            success: function (data) {
                location.reload();
            },
        });
    }

    function collapseAllComponents(){
        $("#collapseAllComponentsButton").attr("onclick","expandAllComponents()");
        $("#collapseAllComponentsButton").text("Expand All");
        $("#treeTable").treetable("collapseAll");
    }

    function expandAllComponents(){
        $("#collapseAllComponentsButton").attr("onclick","collapseAllComponents()");
        $("#collapseAllComponentsButton").text("Collapse All");
        $("#treeTable").treetable("expandAll");
    }

    function collapseAllConnections(){
        $("#collapseAllConnectionsButton").attr("onclick","expandAllConnections()");
        $("#collapseAllConnectionsButton").text("Expand All");
        $("#connectionTable").treetable("collapseAll");
    }

    function expandAllConnections(){
        $("#collapseAllConnectionsButton").attr("onclick","collapseAllConnections()");
        $("#collapseAllConnectionsButton").text("Collapse All");
        $("#connectionTable").treetable("expandAll");
    }

    function collapseAllVariables(){
        $("#collapseAllVariablesButton").attr("onclick","expandAllVariables()");
        $("#collapseAllVariablesButton").text("Expand All");
        $("#variableTable").treetable("collapseAll");
    }

    function expandAllVariables(){
        $("#collapseAllVariablesButton").attr("onclick","collapseAllVariables()");
        $("#collapseAllVariablesButton").text("Collapse All");
        $("#variableTable").treetable("expandAll");
    }

    function addVariable(){
        var variable = {
            name: $("#variable-name").val(),
            component_id: $("#variable-component").val(),
        }

        $.ajax({
            url: '/variables',
            type: 'post',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(variable)
        });
    }

    function editVariable(id){

        variableToBeEdited = id;
        $.ajax({
            url: '/variables/'+ id,
            type: 'get',
            success: function (data) {
                $("#variable-edit-name").val(data.name);
            },
        });
    }

    function sendEditedVariable() {
        var variable = {
            name: $("#variable-edit-name").val(),
        }

        $.ajax({
            url: '/variables/' + variableToBeEdited,
            type: 'put',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(variable)
        });
    }

    function loadVariableToBeDeleted(id){
        variableToBeDeleted = id;
        $.ajax({
                url: '/variables/'+ id,
                type: 'get',
                success: function (data) {
                     $("#variable_delete_name").text(data.name);
                },
            });
    }

    function deleteVariable(){
        $.ajax({
            url: '/variables/'+ variableToBeDeleted,
            type: 'delete',
            success: function (data) {
                location.reload();
            },
        });
    }

    function loadVariableToBeStated(id){
        variableToBeStated = id;
    }

    function addState(){
        var state = {
            name: $("#state-name").val(),
            variable_id: variableToBeStated,
        }

        $.ajax({
            url: '/states',
            type: 'post',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(state)
        });
    }

    function loadStateToBeEdited(id){
        stateToBeEdited = id;
        $.ajax({
            url: '/states/'+ id,
            type: 'get',
            success: function (data) {
                $("#state-edit-name").val(data.name);
            },
        });
    }

    function sendEditedState() {
        var state = {
            name: $("#state-edit-name").val(),
        }

        $.ajax({
            url: '/states/' + stateToBeEdited,
            type: 'put',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(state)
        });
    }

    function loadStateToBeDeleted(id){
        stateToBeDeleted = id;
        $.ajax({
                url: '/states/'+ id,
                type: 'get',
                success: function (data) {
                     $("#state_delete_name").text(data.name);
                },
            });
    }

    function deleteState(){
        $.ajax({
            url: '/states/'+ stateToBeDeleted,
            type: 'delete',
            success: function (data) {
                location.reload();
            },
        });
    }

    function loadComponentToResponsibility(id){
        componentToResponsibility = id;
    }

    function addResponsibility(){
        var responsibility = {
            responsibility: $("#responsibility-name").val(),
            systemSafetyConstraintAssociated: $("#responsibility-ssc").val(),
            component_id: componentToResponsibility,
        }

        $.ajax({
            url: '/responsibilities',
            type: 'post',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(responsibility)
        });
    }

    function loadResponsibilityToBeEdited(id){
        responsibilityToBeEdited = id;
        $.ajax({
            url: '/responsibilities/'+ id,
            type: 'get',
            success: function (data) {
                $("#responsibility-edit-name").val(data.responsibility);
                $("#responsibility-edit-ssc").val(data.systemSafetyConstraintAssociated);
            },
        });
    }

    function sendEditedResponsibility() {
        var responsibility = {
            responsibility: $("#responsibility-edit-name").val(),
            systemSafetyConstraintAssociated: $("#responsibility-edit-ssc").val(),
        }

        $.ajax({
            url: '/responsibilities/' + responsibilityToBeEdited,
            type: 'put',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                location.reload();
            },
            data: JSON.stringify(responsibility)
        });
    }

    function loadResponsibilityToBeDeleted(id){
        responsibilityToBeDeleted = id;
        $.ajax({
                url: '/responsibilities/'+ id,
                type: 'get',
                success: function (data) {
                     $("#responsibility_delete_name").text(data.responsibility);
                },
            });
    }

    function deleteResponsibility(){
        $.ajax({
            url: '/responsibilities/'+ responsibilityToBeDeleted,
            type: 'delete',
            success: function (data) {
                location.reload();
            },
        });
    }

</script>
<script src="/assets/jquery-treetable/jquery.treetable.js"></script>
</body>
</html>